# –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±—ç–∫–µ–Ω–¥–∞ –¥–ª—è –ü—É–±–ª–∏—á–Ω–æ–π –û—Ñ–µ—Ä—Ç—ã

## ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### 1. –ú–æ–¥–µ–ª–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ ‚úÖ
- ‚úÖ `LegalDocument` (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è legal) - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –≤—Å–µ—Ö —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ `DocumentAcceptance` (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è legal) - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ `LegalDocumentType` - —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (global_offer, regional_addendum, privacy_policy, etc.)
- ‚úÖ `DocumentTranslation` - –ø–µ—Ä–µ–≤–æ–¥—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —è–∑—ã–∫–∏
- ‚úÖ `CountryLegalConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å—Ç—Ä–∞–Ω
- ‚úÖ `ProviderSpecialTerms` - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- ‚úÖ `SideLetter` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ `Provider` –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤
- ‚úÖ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

### 2. –°–µ—Ä–≤–∏—Å—ã ‚úÖ
- ‚úÖ `VATVerificationService` - –ø—Ä–æ–≤–µ—Ä–∫–∞ VAT –Ω–æ–º–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ VIES API (–ï–°)
- ‚úÖ `DocumentGeneratorService` (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è legal) - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- ‚úÖ `DocumentAcceptanceService` (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è legal) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- ‚úÖ –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–∞–Ω–∞–º–∏ (`utils/countries.py`)

### 3. API Endpoints –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ ‚úÖ
- ‚úÖ `GET /api/providers/{id}/offer/` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ—Ñ–µ—Ä—Ç—ã –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- ‚úÖ `POST /api/providers/{id}/accept-offer/` - –ø—Ä–∏–Ω—è—Ç–∏–µ –æ—Ñ–µ—Ä—Ç—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º (Owner)
- ‚úÖ `POST /api/providers/{id}/verify-vat/` - –ø—Ä–æ–≤–µ—Ä–∫–∞ VAT –Ω–æ–º–µ—Ä–∞ —á–µ—Ä–µ–∑ VIES API

### 4. –°–∏–≥–Ω–∞–ª—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ‚úÖ
- ‚úÖ `handle_offer_acceptance` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –æ—Ñ–µ—Ä—Ç—ã
- ‚úÖ `handle_offer_commission_change` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–º–∏—Å—Å–∏–∏
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞ –æ–± –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è –æ—Ñ–µ—Ä—Ç—ã
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (—Å—Ç–∞—Ä—ã–π —Ñ–ª–æ—É)

### 5. –ê–¥–º–∏–Ω–∫–∞ Django ‚úÖ
- ‚úÖ `LegalDocumentAdmin` (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è legal) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- ‚úÖ `DocumentAcceptanceAdmin` (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è legal) - –ø—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ü–µ–ø—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ `LegalDocumentTypeAdmin` (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è legal) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ `DocumentTranslationAdmin` (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è legal) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ `CountryLegalConfigAdmin` (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è legal) - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å—Ç—Ä–∞–Ω
- ‚úÖ `ProviderSpecialTermsAdmin` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏
- ‚úÖ `SideLetterAdmin` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è–º–∏

### 6. –ë–∏–ª–ª–∏–Ω–≥ –∏ —Ä–∞—Å—á–µ—Ç—ã ‚úÖ
- ‚úÖ `Provider.calculate_commission()` - —Ä–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ñ–µ—Ä—Ç—ã/ProviderSpecialTerms
- ‚úÖ `Provider.calculate_debt()` - —Ä–∞—Å—á–µ—Ç –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Invoice
- ‚úÖ `Provider.get_max_overdue_days()` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø—Ä–æ—Å—Ä–æ—á–∫–∏
- ‚úÖ `Provider.get_blocking_thresholds()` - –ø–æ—Ä–æ–≥–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–∑ ProviderSpecialTerms –∏–ª–∏ –æ—Ñ–µ—Ä—Ç—ã
- ‚úÖ `Provider.can_show_services()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–∫–∞–∑–∞ —É—Å–ª—É–≥
- ‚úÖ `ProviderSpecialTerms.calculate_commission()` - —Ä–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º

### 7. PaymentHistory ‚úÖ
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω FK `contract` ‚Üí `provider` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã FK `invoice` –∏ `offer_acceptance` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
- ‚úÖ FK `contract` —Å–¥–µ–ª–∞–Ω nullable –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `__str__()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è invoice/offer
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

### 8. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚úÖ
- ‚úÖ `MultiLevelBlockingService` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ñ–µ—Ä—Ç–∞–º–∏
- ‚úÖ `billing/middleware.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- ‚úÖ `BlockingRuleAdmin` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤ –∫ `ProviderSpecialTerms`

### 9. –û—Ç—á–µ—Ç—ã ‚úÖ
- ‚úÖ `reports/services.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `provider.calculate_debt()` –∏ `provider.payment_history`
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω `contract.get_payment_schedule()` –Ω–∞ —Ä–∞–±–æ—Ç—É —Å Invoice

### 10. Celery –∑–∞–¥–∞—á–∏ ‚úÖ
- ‚úÖ `activate_pending_offers()` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π –æ—Ñ–µ—Ä—Ç
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Celery Beat –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ñ–µ—Ä—Ç

---

## ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Invoice ‚ö†Ô∏è
- ‚ö†Ô∏è **–ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –∫–æ–º–∏—Å—Å–∏—è –∏–∑ –æ—Ñ–µ—Ä—Ç—ã/ProviderSpecialTerms –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Invoice
- ‚ö†Ô∏è **–ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨**: –°–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏ InvoiceLine —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π –∏–∑ `Provider.calculate_commission()`
- ‚úÖ Invoice —É–∂–µ —Å–≤—è–∑–∞–Ω —Å Provider (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
- ‚úÖ –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –ù–ï —Å–æ–∑–¥–∞–µ—Ç—Å—è Contract (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ `users/signals.py`)
- ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ InvoiceLine –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `provider.calculate_commission(booking.amount, booking.currency)` –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏ —Å Contract

### 2. API –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ ‚ùå
- ‚ùå **–ù–ï –°–û–ó–î–ê–ù–´**: API endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ñ–µ—Ä—Ç–∞–º–∏ (–∞–¥–º–∏–Ω–∫–∞)
  - `GET /api/admin/offers/` - —Å–ø–∏—Å–æ–∫ –ø—É–±–ª–∏—á–Ω—ã—Ö –æ—Ñ–µ—Ä—Ç
  - `POST /api/admin/offers/` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –æ—Ñ–µ—Ä—Ç—ã
  - `PUT /api/admin/offers/{id}/` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ñ–µ—Ä—Ç—ã
  - `POST /api/admin/providers/{id}/side-letter/` - —Å–æ–∑–¥–∞–Ω–∏–µ Side Letter
- ‚ö†Ô∏è **–ü–†–ò–ú–ï–ß–ê–ù–ò–ï**: –î–ª—è MVP –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –∞–¥–º–∏–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ Django Admin

---

## ‚úÖ –£–î–ê–õ–ï–ù–ò–ï CONTRACT (–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û)

### 1. –£–¥–∞–ª–µ–Ω–∏–µ Contract ‚úÖ
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (`Contract`, `ContractType`, `ContractCommission`, `ContractDiscount`, `ContractApprovalHistory`)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã API endpoints –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (`ContractViewSet`, `ContractTypeViewSet`, –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ workflow)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (`ContractAdmin`, `ContractTypeAdmin`, –≤—Å–µ inline –∫–ª–∞—Å—Å—ã)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (`ContractSerializer`, `ContractCreateSerializer`, `ContractTypeSerializer`)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã URL patterns –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ Contract –≤ –∫–æ–¥–µ:
  - ‚úÖ `billing/models.py` - —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ –º–æ–¥–µ–ª–∏ Contract, –æ–±–Ω–æ–≤–ª–µ–Ω `PaymentHistory.__str__()`
  - ‚úÖ `billing/admin.py` - —É–¥–∞–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∫–∞
  - ‚úÖ `billing/api_views.py` - —É–¥–∞–ª–µ–Ω—ã ViewSet –∏ —Ñ—É–Ω–∫—Ü–∏–∏
  - ‚úÖ `billing/serializers.py` - —É–¥–∞–ª–µ–Ω—ã —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
  - ‚úÖ `billing/urls.py` - —É–¥–∞–ª–µ–Ω—ã URL patterns
  - ‚úÖ `billing/tasks.py` - —É–¥–∞–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã Contract
  - ‚úÖ `billing/services.py` - —É–¥–∞–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö
  - ‚úÖ `billing/middleware.py` - —É–¥–∞–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã Contract
  - ‚úÖ `reports/services.py` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `provider.calculate_commission()`
  - ‚úÖ `audit/signals.py` - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Å–∏–≥–Ω–∞–ª –¥–ª—è Contract
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `0006_remove_contract_tables.py`
- ‚úÖ **–í–°–ï –¢–ê–ë–õ–ò–¶–´ CONTRACT –£–î–ê–õ–ï–ù–´ –ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–•!**

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ë–ï–ó —Ñ—Ä–æ–Ω—Ç–∞)

**–°–ø–æ—Å–æ–±—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ Django management –∫–æ–º–∞–Ω–¥—ã (—É–∂–µ –µ—Å—Ç—å: `test_offer_commission`, `test_invoice_generation`)
- ‚úÖ API endpoints (—á–µ—Ä–µ–∑ curl, Postman, –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã)
- ‚úÖ Django shell (`python manage.py shell`)
- ‚úÖ Unit/Integration —Ç–µ—Å—Ç—ã (Django TestCase)

**–°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤:**
- ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**: –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Invoice
  - ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `python manage.py test_offer_commission --create-offer --create-invoice --booking-amount 2000`
  - ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ö–æ–º–∏—Å—Å–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (5% –æ—Ç —Å—É–º–º—ã)
  - ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: Invoice —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π
  - ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ü–æ—Ä–æ–≥–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—É—á–∞—é—Ç—Å—è –∏–∑ –æ—Ñ–µ—Ä—Ç—ã
  - ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –†–∞—Å—á–µ—Ç –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

- ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**: –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É —Ä–∞–±–æ—Ç—ã —Å –æ—Ñ–µ—Ä—Ç–∞–º–∏
  - ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `python manage.py test_full_offer_flow`
  - ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
    - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏ –æ—Ñ–µ—Ä—Ç—ã
    - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ—Ñ–µ—Ä—Ç—ã —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    - –ü—Ä–∏–Ω—è—Ç–∏–µ –æ—Ñ–µ—Ä—Ç—ã (—Å–æ–∑–¥–∞–Ω–∏–µ DocumentAcceptance)
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
    - –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—É–º–º
    - –†–∞—Å—á–µ—Ç –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏
    - –ü–æ—Ä–æ–≥–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- ‚è≥ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ API –∏–ª–∏ management –∫–æ–º–∞–Ω–¥—É)
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ VAT —á–µ—Ä–µ–∑ VIES (—á–µ—Ä–µ–∑ API: `POST /api/providers/{id}/verify-vat/`)
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–∏—è –æ—Ñ–µ—Ä—Ç—ã (—á–µ—Ä–µ–∑ API: `POST /api/providers/{id}/accept-offer/`)
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏)
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (—á–µ—Ä–µ–∑ Django shell –∏–ª–∏ management –∫–æ–º–∞–Ω–¥—É)
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±–∏–ª–ª–∏–Ω–≥–æ–º (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª)

---

## üìã –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Invoice
**–í–æ–ø—Ä–æ—Å**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ `Provider.calculate_commission()` –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Invoice?

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- `billing/api_views.py` - —Å–æ–∑–¥–∞–Ω–∏–µ Invoice
- `billing/tasks.py` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Invoice
- –õ—é–±—ã–µ –º–µ—Å—Ç–∞, –≥–¥–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è `Invoice` –∏–ª–∏ `InvoiceLine`

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```python
# –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ InvoiceLine –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
commission = provider.calculate_commission(booking.amount, booking.currency)
invoice_line = InvoiceLine.objects.create(
    invoice=invoice,
    booking=booking,
    amount=booking.amount,
    commission=commission  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è –∏–∑ –æ—Ñ–µ—Ä—Ç—ã
)
```

### 2. –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ ‚úÖ
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**: ‚úÖ –£–±—Ä–∞–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- ‚úÖ `users/signals.py` (—Å—Ç—Ä–æ–∫–∏ 296-418) - –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `Provider`, –±–µ–∑ `Contract`
- ‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç –±–æ–ª—å—à–µ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üìä –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ: 100%
- ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ API –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –°–∏–≥–Ω–∞–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –ê–¥–º–∏–Ω–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ –ë–∏–ª–ª–∏–Ω–≥ –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ PaymentHistory –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω (Contract –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è)
- ‚úÖ **Contract –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω** (–º–æ–¥–µ–ª–∏, API, –∞–¥–º–∏–Ω–∫–∞, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã, URL)

### –û—Å—Ç–∞–ª–æ—Å—å: 0% (–≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã)
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é InvoiceLine (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `provider.calculate_commission()`) - **–µ—Å–ª–∏ InvoiceLine —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü Contract –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö - **–í–´–ü–û–õ–ù–ï–ù–û**
- ‚ùå API –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è MVP, –∞–¥–º–∏–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ Django Admin)
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ñ—Ä–æ–Ω—Ç–æ–º)

---

## ‚úÖ –í–´–í–û–î

**–ë—ç–∫–µ–Ω–¥ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω!**

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã:
- ‚úÖ –ú–æ–¥–µ–ª–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ API –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- ‚úÖ –°–∏–≥–Ω–∞–ª—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- ‚úÖ –ë–∏–ª–ª–∏–Ω–≥ –∏ —Ä–∞—Å—á–µ—Ç—ã
- ‚úÖ –ê–¥–º–∏–Ω–∫–∞

**–ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Ñ—Ä–æ–Ω—Ç–∞!**

**–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å:**
1. ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü Contract –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã Contract –ø—É—Å—Ç—ã (0 –∑–∞–ø–∏—Å–µ–π)
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `0006_remove_contract_tables.py`
   - ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ (`python manage.py migrate billing`)
   - ‚úÖ –£–¥–∞–ª–µ–Ω FK `contract` –∏–∑ PaymentHistory
   - ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã Contract (5 —Ç–∞–±–ª–∏—Ü)
   - ‚úÖ **–í–°–ï –¢–ê–ë–õ–ò–¶–´ CONTRACT –£–î–ê–õ–ï–ù–´ –ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–•!**
2. ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é InvoiceLine (–µ—Å–ª–∏ InvoiceLine —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `provider.calculate_commission()`)
3. ‚ùå API –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è MVP, –∞–¥–º–∏–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ Django Admin)
4. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ñ—Ä–æ–Ω—Ç–æ–º)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ü–æ—Ö–æ–∂–µ, —á—Ç–æ InvoiceLine –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ. –ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Invoice, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `provider.calculate_commission()` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ InvoiceLine.

