# Письма при регистрации провайдера: адресаты и шаблоны (спецификация)

Спецификация писем для **двух моментов**: заявка подана (провайдер ещё не активирован) и провайдер активирован. Для каждого момента заданы адресаты и отдельные тексты (тема + тело) в зависимости от роли получателя.

**Правило обращения:**
- **Автор заявки** и **админ провайдера** — обращение **по имени из учётки** (User: first_name), личное письмо.
- **Email организации** — обращение **безличное** (без привязки к пользователю; организация может не быть в системе).

Один и тот же email получает только одно письмо (дедупликация по адресу). Текст выбирается по **роли** получателя.

**Языки:** Письмо составляется на **том языке, который был выбран автором заявки** (при подаче заявки). На фронте и в шаблонах поддерживаются 4 языка: EN, RU, DE, ME; темы и переводимые фразы должны быть заданы для всех четырёх (fallback при отсутствии перевода — EN).

**Кейс «сразу активирован»:** Если в один и тот же момент и заявка подана, и провайдер активирован (нет ручной модерации, например автоактивация после принятия оферты), письма момента «заявка подана» **не отправляются**. Отправляются только письма момента «провайдер активирован» (автор, организация, админ) на языке автора заявки.

---

## Момент 1. Заявка подана (провайдер не активирован)

Используется только когда провайдер **ещё не** активирован (ожидает модерации). Если провайдер активируется сразу — см. кейс выше; момент 1 пропускается.

**Адресаты (в общем случае):**
1. **Автор заявки** (created_by) — email из учётки того, кто подал заявку.
2. **Email организации** (provider.email) — если отличается от email автора.

Админ провайдера в этом моменте отдельным письмом не уведомляется (или по решению продукта — см. ниже).

---

### 1.1 Письмо автору заявки (submitted)

- **Тема (все 4 языка фронта):**  
  EN: Your provider registration request has been submitted  
  RU: Ваша заявка на регистрацию провайдера зарегистрирована  
  DE: Ihr Antrag auf Anbieter-Registrierung wurde eingereicht  
  ME: Vaš zahtev za registraciju pružaoca usluga je poslat  

- **Обращение:** по имени из учётки (например: «Здравствуйте, Семён!»).

- **Тело (смысл):**  
  Мы получили вашу заявку на регистрацию провайдера **{provider_name}**.  
  Мы рассмотрим заявку и отправим вам письмо с инструкциями после активации провайдера.  
  Спасибо за регистрацию.  
  При вопросах — обращайтесь в поддержку.

---

### 1.2 Письмо на email организации (submitted)

- **Тема (все 4 языка):**  
  EN: Provider registration request received: {provider_name}  
  RU: Получена заявка на регистрацию: {provider_name}  
  DE: Antrag auf Anbieter-Registrierung eingegangen: {provider_name}  
  ME: Zahtev za registraciju pružaoca primljen: {provider_name}  

- **Обращение:** безличное (например: «Уважаемые представители организации» / «Dear representative» / «Sehr geehrte Damen und Herren» / «Poštovani»).

- **Тело (смысл):**  
  Получена заявка на регистрацию организации **{provider_name}** в качестве провайдера.  
  Заявка будет рассмотрена. После активации провайдера заявитель и указанный администратор получат отдельные уведомления с инструкциями.  
  Это письмо отправлено для сведения.  
  При вопросах — обращайтесь в поддержку.

---

## Момент 2. Провайдер активирован

**Адресаты (в общем случае):**
1. **Автор заявки** (created_by).
2. **Email организации** (provider.email) — если отличается от автора.
3. **Админ провайдера** (admin_email из заявки) — если отличается от автора и от email организации.

---

### 2.1 Письмо автору заявки (activated)

- **Тема (все 4 языка):**  
  EN: Your provider registration has been confirmed  
  RU: Ваша регистрация провайдера подтверждена  
  DE: Ihre Anbieter-Registrierung wurde bestätigt  
  ME: Vaša registracija pružaoca usluga je potvrđena  

- **Обращение:** по имени из учётки.

- **Тело (смысл):**  
  Ваша заявка на регистрацию провайдера **{provider_name}** одобрена; аккаунт провайдера активирован.  
  Вход в панель администратора провайдера имеет **только администратор провайдера** (ему на **{admin_email}** отправлено отдельное письмо с данными для входа и инструкцией по настройке). Это письмо — для вашего сведения.  
  По вопросам — обращайтесь к биллинг-менеджеру (контакт ниже) или в поддержку.

---

### 2.2 Письмо на email организации (activated)

- **Тема (все 4 языка):**  
  EN: Provider registration confirmed: {provider_name}  
  RU: Регистрация организации подтверждена: {provider_name}  
  DE: Anbieter-Registrierung bestätigt: {provider_name}  
  ME: Registracija pružaoca potvrđena: {provider_name}  

- **Обращение:** безличное.

- **Тело (смысл):**  
  Регистрация организации **{provider_name}** в качестве провайдера подтверждена.  
  Доступ в панель администратора предоставлен администратору провайдера (email: **{admin_email}**). Ему отправлено отдельное письмо с данными для входа.  
  Данное письмо — для сведения. По вопросам входа и настройки обращайтесь к указанному администратору или в поддержку.  
  При необходимости — контакт биллинг-менеджера.

---

### 2.3 Письмо админу провайдера (activated)

**Только этот получатель** получает данные для входа в админ-панель и инструкцию по настройке; автор и организация — только уведомление об активации.

- **Тема (все 4 языка):**  
  EN: Your provider account has been activated  
  RU: Ваш аккаунт провайдера активирован  
  DE: Ihr Anbieter-Konto wurde aktiviert  
  ME: Vaš nalog pružaoca usluga je aktiviran  

- **Обращение:** по имени из учётки (User, привязанный к admin_email).

- **Тело (смысл):**  
  Вам предоставлен доступ в панель администратора провайдера **{provider_name}**.  
  Данные регистрации: название организации, **ваш email** (логин).  
  Вы можете войти в панель и настроить аккаунт провайдера.  
  Кнопка-ссылка «Перейти в панель администратора» — ссылка на **страницу входа** админ-панели (например `{PROVIDER_ADMIN_URL}/login`, в письме оформлена как кнопка).  
  Как войти: ваш логин, способ входа (пароль или Google), при необходимости — та же ссылка текстом.  
  Инструкция по настройке (локации, услуги и цены, часы работы, сотрудники).  
  Нужна помощь — контакт биллинг-менеджера.

---

## Сводка: кто что получает

| Момент              | Автор заявки | Email организации | Админ провайдера |
|---------------------|--------------|-------------------|------------------|
| Заявка подана       | Личное (имя из учётки), своё тело | Безличное, своё тело | — (или отдельное решение) |
| Провайдер активирован | Личное, своё тело | Безличное, своё тело | Личное (имя из учётки), своё тело |

**Дедупликация:** Один email = одно письмо за момент. Если автор, организация и админ — это один и тот же email, получатель получает **одно** письмо.

**Каким текстом отправлять при совпадении ролей:** Выбирается шаблон по приоритету роли (у кого в письме самая важная информация для этого получателя).
- **Момент «провайдер активирован»:** приоритет у шаблона **админа** — в нём данные для входа и инструкция по настройке; без этого письма пользователь не сможет войти. Итого: один email → одно письмо с телом для админа (2.3).
- **Момент «заявка подана»:** админ в этом моменте не получает отдельного письма; при совпадении автор = организация → одно письмо с телом для **автора** (1.1).
