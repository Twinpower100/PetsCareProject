# Ошибки и расхождения по приложениям

Документ пополняется по мере аудита проекта и фронтенда.
Статусы:
- Найдено: подтверждено в коде/конфигурации
- Требует проверки: вероятная проблема, нужна сверка на окружении

## Проект в целом

### Документация/маршруты
- Найдено: требование версионирования API в заголовке (v1/v2/...) не реализовано — версия задана только в URL.
- Исправлено: Swagger/ReDoc 500 ошибка — исправлен URL паттерн (`swagger<format>` → `swagger.<str:format>/`), добавлены проверки `swagger_fake_view` в критичные методы `get_queryset`/`get_serializer_context`, добавлены `SWAGGER_SETTINGS` в `settings.py`, исправлена проблема с `IPAddressField` в сериализаторах (`legal`, `audit`, `users`) — заменено на `CharField` для избежания ошибки `ValueError: not enough values to unpack` при генерации схемы.
### Конкурентный доступ
- Требует проверки: критические CRUD операции (booking, billing, users) не используют `@transaction.atomic`/`select_for_update()`/`version` поля последовательно, хотя это обязательное требование в `.cursorrules`.

## legal
- Найдено: дублируются API для оферты провайдера (`legal` и `providers/offer_api_views`) с разными форматами ответа. Это приводит к несогласованности фронт/бэк.

## frontend (petcare-web-new)
- Найдено: конфликт версий `react-router-dom@7` и `@types/react-router-dom@5`.
- Найдено: `react@19` + `react-scripts@5` потенциально нестабильная комбинация.

## users
- Найдено: `ProviderForm.documents` — одиночный `FileField`, но фронт отправляет массив `documents[]` (несколько файлов). Возможна потеря файлов или ошибка загрузки.
- Требует проверки: `User.get_managed_providers()` для роли `billing_manager` возвращает всех активных провайдеров, что может противоречить ТЗ (биллинг-менеджер не должен видеть всё).
- Требует проверки: фронтовые запросы `check-phone` используют параметр `phone`, сервер ожидает `phone` (совпадает), но валидация форматов строгая. Нужна проверка с фактическими форматами, которые отправляет UI.

## audit / geolocation
- Требует проверки: документация модулей актуальна, но требуется сверка фактических эндпоинтов и настроек в `settings.py` и `urls.py`.

