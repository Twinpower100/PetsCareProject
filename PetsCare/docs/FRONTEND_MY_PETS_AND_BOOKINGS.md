# Фронтенд: «Мои питомцы» и записи в профиле пользователя

Спецификация для реализации в профиле пользователя раздела «Мои питомцы»: список питомцев, добавление/удаление, карточка питомца, инвайты совладельцев и блок записей (бронирования и передержки).

Соответствует разделам 2.x FunctionalDesign.md и коду бэкенда (pets, booking, sitters).

---

## 1. Размещение в UI

- В **профиле пользователя** (Account / Личный кабинет) добавить **вкладку или пункт меню** — «Мои питомцы».
- На этой вкладке:
  - **Список питомцев** (карточки или таблица).
  - Кнопка **«Добавить питомца»**.
  - Для каждого питомца: имя, тип, порода, кнопки «Редактировать», «Удалить» (удаление только для основного владельца).
  - При клике на питомца — **карточка/страница питомца**: основная информация, медицинская карта (при необходимости), **совладельцы и инвайты**.
  - Отдельный **блок «Записи»**: вкладки или фильтры — **Предстоящие**, **Завершённые**, **Незавершённые**, **Отменённые**.

---

## 2. API: питомцы (Pets)

Базовый префикс: `GET/POST /api/v1/pets/` (приложение `pets`).

Все запросы требуют заголовок: `Authorization: Bearer <token>`.

| Метод | URL | Описание |
|-------|-----|----------|
| GET | `/api/v1/pets/` | Список питомцев текущего пользователя (владелец или совладелец). |
| POST | `/api/v1/pets/` | Создать питомца. Текущий пользователь становится основным владельцем. |
| GET | `/api/v1/pets/<id>/` | Детали питомца. |
| PUT | `/api/v1/pets/<id>/` | Обновить питомца (полное обновление). |
| PATCH | `/api/v1/pets/<id>/` | Частичное обновление. |
| DELETE | `/api/v1/pets/<id>/delete/` | Удалить питомца. **Только основной владелец** (или админ). |

Тело POST/PUT/PATCH для питомца (основные поля): `name`, `pet_type` (id), `breed` (id, опционально), `date_of_birth`, `weight`, `description`, `special_needs`, `medical_conditions`, `photo`, `is_active`. В ответе приходят те же поля + `id`, `main_owner`, `owners`, `created_at`, `updated_at`.

---

## 3. API: инвайты совладельцев

| Метод | URL | Описание |
|-------|-----|----------|
| POST | `/api/v1/pets/<pet_id>/invite/` | Создать инвайт. **Только основной владелец.** Тело: `{ "type": "invite" \| "transfer", "email": "…", "expires_in": 24 }` (часы). Ответ — объект инвайта (токен, ссылка и т.д.). |
| POST | `/api/v1/pets/accept-invite/` | Принять инвайт. Тело: `{ "token": "uuid" }`. |
| POST | `/api/v1/pets/<id>/remove_myself_as_coowner/` | Выйти из совладельцев (только совладелец, не основной владелец). |

Для отображения списка инвайтов по питомцу: при необходимости можно добавить на бэкенде эндпоинт вида `GET /api/v1/pets/<pet_id>/invites/` или получать данные из деталей питомца/отдельного ресурса инвайтов, если он появится.

---

## 4. API: бронирования (Bookings)

Базовый префикс: `/api/v1/bookings/` (приложение `booking`).

| Метод | URL | Описание |
|-------|-----|----------|
| GET | `/api/v1/bookings/` | Список бронирований текущего пользователя (как клиент — свои записи). |

**Фильтр по статусу:** `?status=<status_id>` или по имени статуса, если API отдаёт имя. В модели статусы: `active`, `completed`, `cancelled_by_client`, `cancelled_by_provider`, `pending_confirmation`, `no_show_by_client`, `no_show_by_provider`. Для клиента обычно нужны: активные, завершённые, отменённые.

**Рекомендация:** на фронте запрашивать список без фильтра и группировать по категориям (предстоящие/завершённые/отменённые) по полю `status` и дате `start_time`, либо использовать фильтр `status`, если бэкенд поддерживает фильтрацию по имени статуса.

---

## 5. API: передержки (Pet-sitting)

Базовый префикс: `/api/v1/pet-sitting/` (приложение `sitters`).

| Метод | URL | Описание |
|-------|-----|----------|
| GET | `/api/v1/pet-sitting/` | Список передержек текущего пользователя (как владелец питомца или ситтер). |

**Фильтр по статусу:** `?status=<status>` — значения: `waiting_start`, `active`, `waiting_end`, `completed`, `cancelled`.

---

## 6. Соответствие «записей» и статусов на фронте

Имеет смысл объединить в одном блоке «Записи»:
- записи в учреждениях (Bookings) и
- передержки (Pet-sitting),

и показывать вкладки:

| Вкладка на фронте | Bookings | Pet-sitting |
|-------------------|----------|-------------|
| **Предстоящие** | `active` или `pending_confirmation`, и `start_time` в будущем | `waiting_start` (и при необходимости `active` с датой в будущем) |
| **Завершённые** | `completed` | `completed` |
| **Незавершённые** | `active` с `start_time` в прошлом (началось, но не завершено) | `active`, `waiting_end` |
| **Отменённые** | `cancelled_by_client`, `cancelled_by_provider` | `cancelled` |

Реализация: либо два запроса (bookings + pet-sitting) и объединение на фронте с разметкой типа записи, либо один агрегирующий эндпоинт на бэкенде (если будет добавлен).

---

## 7. Структура экрана «Мои питомцы»

1. **Заголовок:** «Мои питомцы» + кнопка «Добавить питомца».
2. **Список питомцев:** для каждого — аватар/фото, имя, тип, порода, дата рождения (или возраст), кнопки «Редактировать», «Удалить» (показывать «Удалить» только основному владельцу).
3. **Форма добавления/редактирования питомца:** модальное окно или отдельная страница. Поля: имя, тип (выбор из списка PetType), порода (выбор, опционально), дата рождения, вес, описание, особые потребности, медицинские условия, фото. Справочники типов/пород: `GET /api/v1/pet-types/search/`, `GET /api/v1/breeds/search/` (см. pets urls).
4. **Карточка питомца (страница или раскрывающийся блок):**
   - Основная информация (редактируемая для владельца).
   - Раздел **«Совладельцы»**: список совладельцев, кнопка «Пригласить совладельца» (email + тип инвайта: приглашение или передача прав). Отображение ожидающих инвайтов (если бэкенд отдаёт).
   - При необходимости — ссылка на медицинскую карту и записи о процедурах.
5. **Блок «Записи»:** вкладки «Предстоящие», «Завершённые», «Незавершённые», «Отменённые». В каждой — список записей (booking и/или pet-sitting) с датой, услугой/передержкой, питомцем, статусом.

---

## 8. Локализация (i18n)

Рекомендуемые ключи (например, для namespace `account` или `myPets`):

```json
{
  "myPets": {
    "title": "Мои питомцы",
    "addPet": "Добавить питомца",
    "editPet": "Редактировать питомца",
    "deletePet": "Удалить питомца",
    "noPets": "У вас пока нет питомцев.",
    "confirmDelete": "Вы уверены, что хотите удалить питомца?",
    "coOwners": "Совладельцы",
    "inviteCoOwner": "Пригласить совладельца",
    "transferOwnership": "Передать права основного владельца",
    "inviteByEmail": "Email для приглашения",
    "inviteSent": "Приглашение отправлено",
    "leaveAsCoOwner": "Покинуть питомца (удалить себя из совладельцев)",
    "bookings": "Записи",
    "upcoming": "Предстоящие",
    "completed": "Завершённые",
    "inProgress": "Незавершённые",
    "cancelled": "Отменённые",
    "noBookings": "Нет записей",
    "noSittings": "Нет передержек",
    "petSitting": "Передержка",
    "booking": "Запись в учреждение"
  }
}
```

Аналогичные ключи добавить для EN, DE, ME (ru/en/de/me по проекту).

---

## 9. Краткий чеклист для фронта

- [ ] Вкладка/пункт меню «Мои питомцы» в профиле пользователя.
- [ ] GET `/api/v1/pets/` — список, отображение карточек.
- [ ] POST `/api/v1/pets/` — форма добавления питомца (тип, порода из API поиска).
- [ ] GET/PATCH `/api/v1/pets/<id>/` — просмотр и редактирование карточки.
- [ ] DELETE `/api/v1/pets/<id>/delete/` — удаление (только основной владелец).
- [ ] POST `/api/v1/pets/<pet_id>/invite/` — инвайт совладельца/передача прав.
- [ ] POST `/api/v1/pets/accept-invite/` — принятие инвайта (страница по ссылке из письма).
- [ ] POST `/api/v1/pets/<id>/remove_myself_as_coowner/` — выход из совладельцев.
- [ ] GET `/api/v1/bookings/` — список бронирований, фильтр по статусу при необходимости.
- [ ] GET `/api/v1/pet-sitting/` — список передержек, фильтр `?status=...`.
- [ ] Блок «Записи» с вкладками: Предстоящие, Завершённые, Незавершённые, Отменённые.
- [ ] i18n для всех строк раздела.

Детали полей и валидации — в FunctionalDesign.md (разделы 2.x) и в коде бэкенда: `PetsCare/pets/`, `PetsCare/booking/`, `PetsCare/sitters/`.
