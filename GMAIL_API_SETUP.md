# üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gmail API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ PetCare —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É email —á–µ—Ä–µ–∑ Gmail API —Å OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –≤–º–µ—Å—Ç–æ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ SMTP. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Gmail API

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ **OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ **–¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö** —á–µ—Ä–µ–∑ HTTPS

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ **–ú–µ–Ω—å—à–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** –æ—Ç Google
- ‚úÖ **–í—ã—Å–æ–∫–∏–µ –∫–≤–æ—Ç—ã** –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTML –ø–∏—Å–µ–º**
- ‚úÖ **–í–ª–æ–∂–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤**
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ **Fallback –Ω–∞ SMTP** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üîß –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Google Cloud Console

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [Google Cloud Console](https://console.cloud.google.com/)**
2. **–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π Google –∞–∫–∫–∞—É–Ω—Ç**
3. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç** –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π:
   - –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç"**
   - –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: `petcare-email`
   - –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å"**

### –®–∞–≥ 2: –í–∫–ª—é—á–µ–Ω–∏–µ Gmail API

1. **–í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ "APIs & Services" ‚Üí "Library"**
2. **–ù–∞–π–¥–∏—Ç–µ "Gmail API"** –≤ –ø–æ–∏—Å–∫–µ
3. **–ù–∞–∂–º–∏—Ç–µ –Ω–∞ Gmail API**
4. **–ù–∞–∂–º–∏—Ç–µ "Enable"** (–í–∫–ª—é—á–∏—Ç—å)

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ OAuth 2.0 —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

1. **–í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ "APIs & Services" ‚Üí "Credentials"**
2. **–ù–∞–∂–º–∏—Ç–µ "Create Credentials" ‚Üí "OAuth 2.0 Client IDs"**
3. **–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: "Desktop application"**
4. **–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: `PetCare Email Client`**
5. **–ù–∞–∂–º–∏—Ç–µ "Create"**
6. **–°–∫–∞—á–∞–π—Ç–µ JSON —Ñ–∞–π–ª** —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ

1. **–ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª** –≤ `credentials.json`
2. **–ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª** –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ PetCare
3. **–î–æ–±–∞–≤—å—Ç–µ –≤ .gitignore**:
   ```
   credentials.json
   token.json
   ```

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–í —Ñ–∞–π–ª `.env` –¥–æ–±–∞–≤—å—Ç–µ:**
```bash
# Gmail API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
USE_GMAIL_API=True
GMAIL_API_FALLBACK_TO_SMTP=True
GMAIL_CREDENTIALS_FILE=credentials.json
GMAIL_TOKEN_FILE=token.json

# SMTP fallback –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è)
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=noreply@petcare.com
```

### –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```bash
python manage.py setup_gmail_api --test
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úì Gmail API connection test successful
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ email

### –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞
```bash
python manage.py shell
```

```python
from django.core.mail import send_mail

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∏—Å—å–º–∞
result = send_mail(
    subject='Test Email from PetCare',
    message='This is a test email sent via Gmail API',
    from_email='noreply@petcare.com',
    recipient_list=['test@example.com'],
    fail_silently=False
)

print(f"Email sent: {result}")
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
tail -f logs/django.log | grep "Gmail API"
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ settings.py

```python
# Gmail API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
USE_GMAIL_API = True  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gmail API
GMAIL_API_FALLBACK_TO_SMTP = True  # Fallback –Ω–∞ SMTP
GMAIL_CREDENTIALS_FILE = 'credentials.json'  # –§–∞–π–ª —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
GMAIL_TOKEN_FILE = 'token.json'  # –§–∞–π–ª —Å —Ç–æ–∫–µ–Ω–æ–º

# Email backend (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä)
if USE_GMAIL_API:
    EMAIL_BACKEND = 'notifications.gmail_api_backend.GmailAPIBackend'
else:
    EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `USE_GMAIL_API` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gmail API | `True` |
| `GMAIL_API_FALLBACK_TO_SMTP` | Fallback –Ω–∞ SMTP | `True` |
| `GMAIL_CREDENTIALS_FILE` | –§–∞–π–ª —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ | `credentials.json` |
| `GMAIL_TOKEN_FILE` | –§–∞–π–ª —Å —Ç–æ–∫–µ–Ω–æ–º | `token.json` |

## üîÑ Fallback –º–µ—Ö–∞–Ω–∏–∑–º

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ SMTP –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

1. **Gmail API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**
2. **–û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
3. **–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –∫–≤–æ—Ç**
4. **–°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ fallback
```
INFO: Gmail API connection failed, attempting SMTP fallback
INFO: Email sent successfully via SMTP fallback
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –õ–æ–≥–∏ Gmail API
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –æ—Ç–ø—Ä–∞–≤–∫–∏
grep "Gmail API" logs/django.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—à–∏–±–æ–∫
grep "Error.*Gmail API" logs/django.log
```

### Google Cloud Console
1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)**
2. **–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç**
3. **APIs & Services ‚Üí Dashboard**
4. **–ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Gmail API**

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "Gmail API service not available"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: `pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ `credentials.json`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `python manage.py setup_gmail_api --check-files`

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid credentials"
**–†–µ—à–µ–Ω–∏–µ:**
1. –£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª `token.json`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü—Ä–æ–π–¥–∏—Ç–µ OAuth2 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ

### –ü—Ä–æ–±–ª–µ–º–∞: "Quota exceeded"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–≤–æ—Ç—ã –≤ Google Cloud Console
2. –í–∫–ª—é—á–∏—Ç–µ fallback –Ω–∞ SMTP
3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–ª–∞—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã Google

### –ü—Ä–æ–±–ª–µ–º–∞: "Network error"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SMTP fallback

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ **–ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ** `credentials.json` –∏ `token.json` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- ‚úÖ **–î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª—ã** –≤ `.gitignore`
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** OAuth2 —Ç–æ–∫–µ–Ω—ã
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### –§–∞–π–ª—ã –¥–ª—è –∑–∞—â–∏—Ç—ã
```
credentials.json  # OAuth2 —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
token.json       # –¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞
.env             # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ö–≤–æ—Ç—ã Gmail API
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å**: 1,000,000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
- **–ü–ª–∞—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã**: –æ—Ç $0.10 –∑–∞ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤
- **–õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏**: 250 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **Batch –æ—Ç–ø—Ä–∞–≤–∫–∞** –ø–∏—Å–µ–º
- ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** —á–µ—Ä–µ–∑ Celery
- ‚úÖ **Retry –ª–æ–≥–∏–∫–∞** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Gmail API** –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—ã—à–µ
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É** email
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. **–û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –∫–æ–º–∞–Ω–¥—ã
5. **–ü—Ä–æ–≤–µ–¥–∏—Ç–µ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- [Gmail API Documentation](https://developers.google.com/gmail/api/)
- [Google Cloud Console](https://console.cloud.google.com/)
- [OAuth 2.0 Guide](https://developers.google.com/identity/protocols/oauth2)

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤
python manage.py setup_gmail_api --check-files

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
python manage.py setup_gmail_api --test

# –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
python manage.py setup_gmail_api --create-credentials-template
``` 